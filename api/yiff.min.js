// @ts-nocheck
export default async function handler(e,t){const{postId:r}=e.query;if(!r)return t.status(400).json({error:"Post ID not specified!"});const s=`https://${(e.headers.host||"").includes("e926")?"e926.net":"e621.net"}/posts/${r}.json`;try{const e=await fetch(s,{headers:{"User-Agent":"MyE621Proxy/1.0 (by yourusername on e621)"}});if(!e.ok)return t.status(e.status).json({error:"Failed to fetch post data"});const r=await e.json(),o=r?.post;if(!o||!o.file?.url)return t.status(404).json({error:"Image URL not found in post data"});const n=await fetch(o.file.url,{headers:{"User-Agent":"MyE621Proxy/1.0 (by yourusername on e621)"}});if(!n.ok)return t.status(n.status).json({error:"Failed to fetch image"});const a=await n.arrayBuffer(),u=Buffer.from(a),i=n.headers.get("content-type")||"image/jpeg";return t.setHeader("Content-Type",i),t.setHeader("Access-Control-Allow-Origin","*"),t.status(200).send(u)}catch(e){return console.error("Error:",e),t.status(500).json({error:"Failed to fetch from E621",details:e.message})}}